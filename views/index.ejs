<!-- index.ejs (ou o nome do seu arquivo EJS) -->

<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUD de Usuários</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

  <h1>CRUD de Usuários</h1>

  <!-- Exibição de Mensagens -->
  <% if (successMessage) { %>
    <div class="success-message">
      <p><%= successMessage %></p>
      <span id="close-success-message">Fechar</span>
    </div>
  <% } %>
  
  <% if (errorMessage) { %>
    <div class="error-message">
      <p><%= errorMessage %></p>
      <span id="close-error-message">Fechar</span>
    </div>
  <% } %>

  <!-- Formulário para Adicionar Usuário -->
  <form id="userForm" method="post" action="/createUser">
    <label for="nome">Nome:</label>
    <input type="text" id="nome" name="nome" required>

    <label for="idade">Idade:</label>
    <input type="number" id="idade" name="idade" required>

    <label for="telefone">Telefone:</label>
    <input type="text" id="telefone" name="telefone" required>

    <button type="submit">Adicionar Usuário</button>
  </form>

  <!-- Tabela para exibir a lista de usuários -->
  <table border="1">
    <thead>
      <tr>
        <th>Nome</th>
        <th>Idade</th>
        <th>Telefone</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody>
      <% users.forEach(user => { %>
        <tr>
          <td><%= user.nome %></td>
          <td><%= user.idade %></td>
          <td><%= user.telefone %></td>
          <td>
            <button onclick="editarUsuario('<%= user._id %>')">Editar</button>
            <button onclick="excluirUsuario('<%= user._id %>')">Excluir</button>
          </td>
        </tr>
      <% }); %>
    </tbody>
  </table>

  <!-- Script JavaScript -->
  <script>
    // Função para editar um usuário
    function editarUsuario(userId) {
      // Implemente a lógica de edição conforme necessário
      console.log('Editar usuário com ID:', userId);
    }

    // Função para excluir um usuário
    function excluirUsuario(userId) {
      const confirmacao = confirm('Deseja realmente excluir este usuário?');
      if (confirmacao) {
        fetch(`/deleteUser/${userId}`, { method: 'DELETE' })
        .then(() => carregarUsuarios())
        .catch(error => console.error('Erro ao excluir usuário:', error));
      }
    }

    // Função para carregar a lista de usuários
    function carregarUsuarios() {
      fetch('/users')
      .then(response => response.json())
      .then(users => {
        const tableBody = document.querySelector('tbody');
        tableBody.innerHTML = ''; // Limpa a tabela antes de preenchê-la novamente

        users.forEach(user => {
          const row = tableBody.insertRow();
          row.innerHTML = `
            <td>${user.nome}</td>
            <td>${user.idade}</td>
            <td>${user.telefone}</td>
            <td>
              <button onclick="editarUsuario('${user._id}')">Editar</button>
              <button onclick="excluirUsuario('${user._id}')">Excluir</button>
            </td>
          `;
        });
      })
      .catch(error => console.error('Erro ao carregar usuários:', error));
    }

    // Carrega a lista de usuários ao carregar a página
    document.addEventListener('DOMContentLoaded', () => {
      carregarUsuarios();
    });

    // Restante do script...
  </script>

</body>
</html>
